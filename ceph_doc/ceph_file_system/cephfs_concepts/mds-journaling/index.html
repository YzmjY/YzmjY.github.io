<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://yzmjy.github.io/ceph_doc/ceph_file_system/cephfs_concepts/mds-journaling/ rel=canonical><link href=../posix/ rel=prev><link href=../file-layouts/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.18"><title>MDS Journal - XZMJX</title><link rel=stylesheet href=../../../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%209.5A2.5%202.5%200%200%200%209.5%2012a2.5%202.5%200%200%200%202.5%202.5%202.5%202.5%200%200%200%202.5-2.5A2.5%202.5%200%200%200%2012%209.5m0%203.5a1%201%200%200%201-1-1%201%201%200%200%201%201-1%201%201%200%200%201%201%201%201%201%200%200%201-1%201m0-3.5A2.5%202.5%200%200%200%209.5%2012a2.5%202.5%200%200%200%202.5%202.5%202.5%202.5%200%200%200%202.5-2.5A2.5%202.5%200%200%200%2012%209.5m0%203.5a1%201%200%200%201-1-1%201%201%200%200%201%201-1%201%201%200%200%201%201%201%201%201%200%200%201-1%201m0-11A10%2010%200%200%200%202%2012a10%2010%200%200%200%2010%2010%2010%2010%200%200%200%2010-10A10%2010%200%200%200%2012%202m0%2014c-2.63%200-5-1.57-6-4a6.505%206.505%200%200%201%208.5-3.5A6.52%206.52%200%200%201%2018%2012c-1%202.43-3.37%204-6%204m0-6.5A2.5%202.5%200%200%200%209.5%2012a2.5%202.5%200%200%200%202.5%202.5%202.5%202.5%200%200%200%202.5-2.5A2.5%202.5%200%200%200%2012%209.5m0%203.5a1%201%200%200%201-1-1%201%201%200%200%201%201-1%201%201%200%200%201%201%201%201%201%200%200%201-1%201%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=https://unpkg.com/katex@0/dist/katex.min.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link rel=stylesheet href=../../../../assets/stylesheets/custom.7c86dd97.min.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=teal> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mds-journal class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../.. title=XZMJX class="md-header__button md-logo" aria-label=XZMJX data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> XZMJX </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> MDS Journal </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=teal aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=teal aria-label="Switch to system preference" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../blog/ class=md-tabs__link> 笔记 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../../lc/algo/ class=md-tabs__link> 杂 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=XZMJX class="md-nav__button md-logo" aria-label=XZMJX data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> XZMJX </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=../../../../blog/ class="md-nav__link "> <span class=md-ellipsis> 笔记 </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> 笔记 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_2> <label class=md-nav__link for=__nav_1_2 id=__nav_1_2_label tabindex=0> <span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> 归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../blog/archive/2025/ class=md-nav__link> <span class=md-ellipsis> 2025 </span> </a> </li> <li class=md-nav__item> <a href=../../../../blog/archive/2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_3> <label class=md-nav__link for=__nav_1_3 id=__nav_1_3_label tabindex=0> <span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> 分类 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../blog/category/c/ class=md-nav__link> <span class=md-ellipsis> C++ </span> </a> </li> <li class=md-nav__item> <a href=../../../../blog/category/go/ class=md-nav__link> <span class=md-ellipsis> Go </span> </a> </li> <li class=md-nav__item> <a href=../../../../blog/category/kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=../../../../blog/category/linux/ class=md-nav__link> <span class=md-ellipsis> Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../../blog/category/minio/ class=md-nav__link> <span class=md-ellipsis> MinIO </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> 杂 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 杂 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <div class="md-nav__link md-nav__container"> <a href=../../../../lc/algo/ class="md-nav__link "> <span class=md-ellipsis> 数据结构与算法 </span> </a> <label class="md-nav__link " for=__nav_2_1 id=__nav_2_1_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 数据结构与算法 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1_2> <label class=md-nav__link for=__nav_2_1_2 id=__nav_2_1_2_label tabindex=0> <span class=md-ellipsis> 基础知识 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1_2> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/algo/array/ class=md-nav__link> <span class=md-ellipsis> Array </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/algo/string/ class=md-nav__link> <span class=md-ellipsis> String </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/algo/heap/ class=md-nav__link> <span class=md-ellipsis> Heap </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <div class="md-nav__link md-nav__container"> <a href=../../../../lc/top-interview-150/ class="md-nav__link "> <span class=md-ellipsis> 刷题 </span> </a> <label class="md-nav__link " for=__nav_2_2 id=__nav_2_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 刷题 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2> <label class=md-nav__link for=__nav_2_2_2 id=__nav_2_2_2_label tabindex=0> <span class=md-ellipsis> Top150 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2> <span class="md-nav__icon md-icon"></span> Top150 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_1> <label class=md-nav__link for=__nav_2_2_2_1 id=__nav_2_2_2_1_label tabindex=0> <span class=md-ellipsis> 数组/字符串 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_1> <span class="md-nav__icon md-icon"></span> 数组/字符串 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/1_88_%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 88. 合并两个有序数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/2_27_%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/ class=md-nav__link> <span class=md-ellipsis> 27. 移除元素 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/3_26_%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/ class=md-nav__link> <span class=md-ellipsis> 26. 删除有序数组中的重复项 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/4_80_%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9%20II/ class=md-nav__link> <span class=md-ellipsis> 80. 删除有序数组中的重复项 II </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/5_169_%E5%A4%9A%E6%95%B0%E5%85%83%E7%B4%A0/ class=md-nav__link> <span class=md-ellipsis> 169.多数元素 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/6_189_%E8%BD%AE%E8%BD%AC%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 189.轮转数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/7_121_%E4%B9%B0%E5%8D%96%E8%82%A1%E7%A5%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E6%97%B6%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 121.买卖股票的最佳时机 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/8_122_%E4%B9%B0%E5%8D%96%E8%82%A1%E7%A5%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E6%97%B6%E6%9C%BA%20II/ class=md-nav__link> <span class=md-ellipsis> 122. 买卖股票的最佳时机 II </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/9_55_%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/ class=md-nav__link> <span class=md-ellipsis> 55. 跳跃游戏 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/10_45_%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F%20II/ class=md-nav__link> <span class=md-ellipsis> 45. 跳跃游戏 II </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/11_274_H%20%E6%8C%87%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 274. H 指数 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/12_380_O%281%29%E6%97%B6%E9%97%B4%E6%8F%92%E5%85%A5%E3%80%81%E5%88%A0%E9%99%A4%E5%92%8C%E8%8E%B7%E5%8F%96%E9%9A%8F%E6%9C%BA%E5%85%83%E7%B4%A0/ class=md-nav__link> <span class=md-ellipsis> 380. O(1) 时间插入、删除和获取随机元素 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/13_238_%E9%99%A4%E8%87%AA%E8%BA%AB%E4%BB%A5%E5%A4%96%E6%95%B0%E7%BB%84%E7%9A%84%E4%B9%98%E7%A7%AF/ class=md-nav__link> <span class=md-ellipsis> 238. 除自身以外数组的乘积 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/14_134_%E5%8A%A0%E6%B2%B9%E7%AB%99/ class=md-nav__link> <span class=md-ellipsis> 134. 加油站 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/15_135_%E5%88%86%E5%8F%91%E7%B3%96%E6%9E%9C/ class=md-nav__link> <span class=md-ellipsis> 135. 分发糖果 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/16_42_%E6%8E%A5%E9%9B%A8%E6%B0%B4/ class=md-nav__link> <span class=md-ellipsis> 42. 接雨水 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/17_13_%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97%E8%BD%AC%E6%95%B4%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 13.罗马数字转整数 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/18_12_%E6%95%B4%E6%95%B0%E8%BD%AC%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97/ class=md-nav__link> <span class=md-ellipsis> 12. 整数转罗马数字 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/19_58_%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%8D%95%E8%AF%8D%E7%9A%84%E9%95%BF%E5%BA%A6/ class=md-nav__link> <span class=md-ellipsis> 58. 最后一个单词的长度 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/20_14_%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80/ class=md-nav__link> <span class=md-ellipsis> 14. 最长公共前缀 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/21_%20151_%E5%8F%8D%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E5%8D%95%E8%AF%8D/ class=md-nav__link> <span class=md-ellipsis> 151. 反转字符串中的单词 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/22_6_Z%E5%AD%97%E5%BD%A2%E5%8F%98%E6%8D%A2/ class=md-nav__link> <span class=md-ellipsis> 6.Z 字形变换 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/23_28_%E6%89%BE%E5%87%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8C%B9%E9%85%8D%E9%A1%B9%E7%9A%84%E4%B8%8B%E6%A0%87/ class=md-nav__link> <span class=md-ellipsis> 28. 找出字符串中第一个匹配项的下标 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/24_68_%E6%96%87%E6%9C%AC%E5%B7%A6%E5%8F%B3%E5%AF%B9%E9%BD%90/ class=md-nav__link> <span class=md-ellipsis> 68. 文本左右对齐 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_2> <label class=md-nav__link for=__nav_2_2_2_2 id=__nav_2_2_2_2_label tabindex=0> <span class=md-ellipsis> 双指针 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_2> <span class="md-nav__icon md-icon"></span> 双指针 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/25_125_%E9%AA%8C%E8%AF%81%E5%9B%9E%E6%96%87%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 125. 验证回文串 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/26_392_%E5%88%A4%E6%96%AD%E5%AD%90%E5%BA%8F%E5%88%97/ class=md-nav__link> <span class=md-ellipsis> 392. 判断子序列 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/27_167_%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8CII-%E8%BE%93%E5%85%A5%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 27. 两数之和 II - 输入有序数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/28_11_%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 11. 盛最多水的容器 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/29_15_%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/ class=md-nav__link> <span class=md-ellipsis> 15. 三数之和 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_3> <label class=md-nav__link for=__nav_2_2_2_3 id=__nav_2_2_2_3_label tabindex=0> <span class=md-ellipsis> 滑动窗口 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_3> <span class="md-nav__icon md-icon"></span> 滑动窗口 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/30_209_%E9%95%BF%E5%BA%A6%E6%9C%80%E5%B0%8F%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 209. 长度最小的子数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/31_3_%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 3. 无重复字符的最长子串 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/32_30_%E4%B8%B2%E8%81%94%E6%89%80%E6%9C%89%E5%8D%95%E8%AF%8D%E7%9A%84%E5%AD%90%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 32. 串联所有单词的子串 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/33_76_%E6%9C%80%E5%B0%8F%E8%A6%86%E7%9B%96%E5%AD%90%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 76. 最小覆盖子串 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_4> <label class=md-nav__link for=__nav_2_2_2_4 id=__nav_2_2_2_4_label tabindex=0> <span class=md-ellipsis> 矩阵 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_4> <span class="md-nav__icon md-icon"></span> 矩阵 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/34_36_%E6%9C%89%E6%95%88%E7%9A%84%E6%95%B0%E7%8B%AC/ class=md-nav__link> <span class=md-ellipsis> 36. 有效的数独 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/35_54_%E8%9E%BA%E6%97%8B%E7%9F%A9%E9%98%B5/ class=md-nav__link> <span class=md-ellipsis> 54. 螺旋矩阵 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/36_48_%E6%97%8B%E8%BD%AC%E5%9B%BE%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 48. 旋转图像 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/37_73_%E7%9F%A9%E9%98%B5%E7%BD%AE%E9%9B%B6/ class=md-nav__link> <span class=md-ellipsis> 73. 矩阵置零 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_5> <label class=md-nav__link for=__nav_2_2_2_5 id=__nav_2_2_2_5_label tabindex=0> <span class=md-ellipsis> 哈希表 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_5> <span class="md-nav__icon md-icon"></span> 哈希表 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/39_383_%E8%B5%8E%E9%87%91%E4%BF%A1/ class=md-nav__link> <span class=md-ellipsis> 383. 赎金信 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/40_205_%E5%90%8C%E6%9E%84%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 205. 同构字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/41_290_%E5%8D%95%E8%AF%8D%E8%A7%84%E5%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 290. 单词规律 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/42_242_%E6%9C%89%E6%95%88%E7%9A%84%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D/ class=md-nav__link> <span class=md-ellipsis> 242. 有效的字母异位词 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/43_49_%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D%E5%88%86%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 49. 字母异位词分组 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3 checked> <div class="md-nav__link md-nav__container"> <a href=../../../ class="md-nav__link "> <span class=md-ellipsis> CEPH文档翻译 </span> </a> <label class="md-nav__link " for=__nav_2_3 id=__nav_2_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> CEPH文档翻译 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_2 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> CEPH文件系统 </span> </a> <label class="md-nav__link " for=__nav_2_3_2 id=__nav_2_3_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_2> <span class="md-nav__icon md-icon"></span> CEPH文件系统 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_2_2 checked> <label class=md-nav__link for=__nav_2_3_2_2 id=__nav_2_3_2_2_label tabindex=0> <span class=md-ellipsis> CephFS 概念 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_2_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_2_2> <span class="md-nav__icon md-icon"></span> CephFS 概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../mds-states/ class=md-nav__link> <span class=md-ellipsis> MDS状态 </span> </a> </li> <li class=md-nav__item> <a href=../posix/ class=md-nav__link> <span class=md-ellipsis> POSIX兼容性 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> MDS Journal </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> MDS Journal </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#cephfs class=md-nav__link> <span class=md-ellipsis> CEPHFS元数据池 </span> </a> </li> <li class=md-nav__item> <a href=#journal class=md-nav__link> <span class=md-ellipsis> Journal记录 </span> </a> </li> <li class=md-nav__item> <a href=#journal_1 class=md-nav__link> <span class=md-ellipsis> Journal 事件 </span> </a> </li> <li class=md-nav__item> <a href=#journal_2 class=md-nav__link> <span class=md-ellipsis> Journal 事件类型 </span> </a> </li> <li class=md-nav__item> <a href=#journal_3 class=md-nav__link> <span class=md-ellipsis> Journal段 </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 配置 </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../file-layouts/ class=md-nav__link> <span class=md-ellipsis> 文件布局(Layout) </span> </a> </li> <li class=md-nav__item> <a href=../mdcache/ class=md-nav__link> <span class=md-ellipsis> 分布式元数据缓存 </span> </a> </li> <li class=md-nav__item> <a href=../dynamic-metadata-mangement/ class=md-nav__link> <span class=md-ellipsis> CEPHFS动态元数据管理 </span> </a> </li> <li class=md-nav__item> <a href=../cephfs-io-path/ class=md-nav__link> <span class=md-ellipsis> CEPHFS IO路径 </span> </a> </li> <li class=md-nav__item> <a href=../charmap/ class=md-nav__link> <span class=md-ellipsis> 大小写敏感性和规范化 </span> </a> </li> <li class=md-nav__item> <a href=../lazyio/ class=md-nav__link> <span class=md-ellipsis> 惰性IO </span> </a> </li> <li class=md-nav__item> <a href=../dirfrags/ class=md-nav__link> <span class=md-ellipsis> 目录分片 </span> </a> </li> <li class=md-nav__item> <a href=../multimds/ class=md-nav__link> <span class=md-ellipsis> 多活MDS </span> </a> </li> <li class=md-nav__item> <a href=../snapshots/ class=md-nav__link> <span class=md-ellipsis> 快照 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_2_3> <label class=md-nav__link for=__nav_2_3_2_3 id=__nav_2_3_2_3_label tabindex=0> <span class=md-ellipsis> 开发者指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_2_3> <span class="md-nav__icon md-icon"></span> 开发者指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-guides/capabilities/ class=md-nav__link> <span class=md-ellipsis> 客户端权限 </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guides/journaler/ class=md-nav__link> <span class=md-ellipsis> Journaler配置 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../architecture/architecture/ class=md-nav__link> <span class=md-ellipsis> CEPH架构 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#cephfs class=md-nav__link> <span class=md-ellipsis> CEPHFS元数据池 </span> </a> </li> <li class=md-nav__item> <a href=#journal class=md-nav__link> <span class=md-ellipsis> Journal记录 </span> </a> </li> <li class=md-nav__item> <a href=#journal_1 class=md-nav__link> <span class=md-ellipsis> Journal 事件 </span> </a> </li> <li class=md-nav__item> <a href=#journal_2 class=md-nav__link> <span class=md-ellipsis> Journal 事件类型 </span> </a> </li> <li class=md-nav__item> <a href=#journal_3 class=md-nav__link> <span class=md-ellipsis> Journal段 </span> </a> </li> <li class=md-nav__item> <a href=#_1 class=md-nav__link> <span class=md-ellipsis> 配置 </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=mds-journal>MDS Journal<a class=headerlink href=#mds-journal title="Permanent link">&para;</a></h1> <h2 id=cephfs>CEPHFS元数据池<a class=headerlink href=#cephfs title="Permanent link">&para;</a></h2> <p>CephFS使用一个与数据池隔离的存储池来管理文件系统的元数据（inodes和dentries），该元数据池包含文件系统层级关系在内的所有文件元信息。除此之外，它还保存一些与文件系统中其他部分相关联的元数据，例如对文件系统操作的日志记录、打开文件句柄表、客户端链接session表等内容。</p> <p>本文档描述了MDS如何使用和回放元数据的Journal。</p> <h2 id=journal>Journal记录<a class=headerlink href=#journal title="Permanent link">&para;</a></h2> <p>MDS在执行文件元数据操作之前，会将对应的元数据操作事件以RADOS对象的形式流式传输到元数据池中。CephFS中，由处于Active状态的MDS进程管理文件和目录的元数据。</p> <p>CephFS使用Journal功能基于以下理由：</p> <ol> <li> <p>一致性： 在MDS故障转移时，可以通过重放Journal中的操作事件来使文件系统的状态达到一致。另外，记录对元数据存储进行多次更新的复杂操作的操作事件，以保证崩溃一致性（以及其他一致性，例如锁等）。</p> </li> <li> <p>性能：Journal的写入是顺序的，因此该操作的速度很快。另外，可以将更新事件合并到一次日志写入中,从而节省更新文件不同部分所涉及的磁盘查找事件。Journal同样有利于备用MDS进行缓存的预热，这在MDS故障转移快速恢复时提供一定的帮助。</p> </li> </ol> <p>每个Active的MDS在元数据池中维护自身的Journal日志。Journal日志被条带化为多个Rados对象。过期的Journal条目将会在合适的时机被删除。</p> <h2 id=journal_1>Journal 事件<a class=headerlink href=#journal_1 title="Permanent link">&para;</a></h2> <p>除了记录文件系统元数据更新，CephFS Journal 还记录了其它各种事件，例如客户端会话信息和目录导入、导出状态等。这些事件被 MDS 用来根据需要重新建立正确的状态，例如，通过重放Journal事件，如果存在特定事件类型指定了一个客户端在MDS 重启之前与其建立了会话，则 MDS 在重启时会尝试重新连接该客户端,</p> <p>为了检查日志中记录的此类事件的列表，CephFS 提供了一个命令行实用程序 cephfs-journal-tool，其使用方式如下：</p> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>cephfs-journal-tool --rank=&lt;fs&gt;:&lt;rank&gt; event get list
</span></code></pre></div> cephfs-journal-tool 还用于发现和修复损坏的 Ceph 文件系统。（有关更多详细信息，请参阅 cephfs-journal-tool）</p> <h2 id=journal_2>Journal 事件类型<a class=headerlink href=#journal_2 title="Permanent link">&para;</a></h2> <p>以下是MDS记录的各类操作事件类型：</p> <ol> <li>EVENT_COMMITTED: 将请求(id)标记为已提交。</li> <li>EVENT_EXPORT：将目录映射到 MDS Rank。</li> <li>EVENT_FRAGMENT：跟踪目录分片（拆分/合并）的各个阶段</li> <li>EVENT_IMPORTSTART：当 MDS Rank开始导入目录分片时记录。</li> <li>EVENT_IMPORTFINISH：当 MDS Rank完成导入目录分片时记录。</li> <li>EVENT_NOOP：用于跳过日志区域的空操作事件类型。</li> <li>EVENT_OPEN：跟踪哪些 inode 具有打开的文件句柄。</li> <li>EVENT_RESETJOURNAL：Used to mark a journal as reset post truncation.</li> <li>EVENT_SESSION: 跟踪打开的客户端Session。</li> <li>EVENT_SLAVEUPDATE: 记录已转发到（从属）mds 的操作的各个阶段。</li> <li>EVENT_SUBTREEMAP：目录 inode 到目录内容（子树分区）的映射。</li> <li>EVENT_TABLECLIENT: Log transition states of MDSs view of client tables (snap/anchor).</li> <li>EVENT_TABLESERVER: Log transition states of MDSs view of server tables (snap/anchor).</li> <li>EVENT_UPDATE：对 inode 执行操作日志文件。</li> <li>EVENT_SEGMENT：记录新的Journal段边界。</li> <li>EVENT_LID：标记没有逻辑子树映射的日志的开头。</li> </ol> <h2 id=journal_3>Journal段<a class=headerlink href=#journal_3 title="Permanent link">&para;</a></h2> <p>MDS的Journal有多个逻辑段组成，在代码中被称为LogSegment。这些段用于将元数据更新的多个事件组合成一个逻辑单元，Journal修剪以这样的一个逻辑单元进行。每当MDS尝试提交元数据操作（例如将文件创建作为omap更新到dirfrag对象）时，它会在一系列更新元数据对象的过程中以可回放的批量更新方式执行这些更新。更新必须是可回放的，以防MDS在对不同的元数据对象的一系列更新过程中崩溃。通过批量更新的方式，可以将对同一个元数据对象的多个更新合并到一个更新中（dirfrag），其中多个omap条目可能在同一时间段内被更新。</p> <p>当一个Journal逻辑段被trim后，它被标记为"过期的"。过期的Journal段可以被journaler安全的删除，因为其所有元数据更新操作都已经被持久化到对应的RADOS对象中。通过更新journaler的"expire position"来将对应的过期Journal段标记为过期。一些过期的Journal段可能会被保留，以提高MDS在重启时的缓存局部性。</p> <p>在 CephFS 的大部分历史中（直到 2023 年），Journal Segment由子树映射（ESubtreeMap 事件）为分界点。这样做的主要原因是，在重播任何其他事件之前，Journal恢复必须从子树 map 的副本开始。</p> <p>现在，Journal Segment可以以 <code>SegmentBoundary</code> 类的事件作为边界点。包括 <code>ESubtreeMap</code>、<code>EResetJournal</code>、<code>ESegment</code> （2023） 或 <code>ELid</code> （2023 年）。对于 <code>ESegment</code>，这种轻量级的 segment 边界允许 MDS 降低记录子树映射的频率，同时保持日志 segment 较小以保持修剪事件简短。为了保证 journal 重放看到的第一个事件是 <code>ESubtreeMap</code>，那些以该事件开头的 segment 被认为是 “major segments”，并且为删除过期的 segment 增加了一个限制：Journal的第一个 segment 必须始终是 major segment。</p> <p><code>ELid</code> 事件的存在是为了将 MDS 日志标记为 “new”，其他操作需要 LogSegment 和日志序列号才能继续，尤其是 MDSTable 操作。MDS 在创建排名或关闭Rank时使用此事件。从此初始状态重放Rank时，不需要子树映射。</p> <h2 id=_1>配置<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <p>Journal分段的大小（以事件数量而言）由以下参数控制：</p> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>mds_log_events_per_segment 
</span></code></pre></div> MDS 日志段中的最大事件数</p> <div class="language-text highlight"><pre><span></span><code>类型 : uint

默认值 : 1024

最小值 : 1
</code></pre></div> <p>自上一个Major Segment 以来的 Minor mds 日志 Segment 的数量由以下参数控制：</p> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>mds_log_minor_segments_per_major_segment
</span></code></pre></div> The number of minor mds log segments since last major segment after which a major segment is started/logged. 自上一个主要分段以来的次要 mds 日志分段数，在此之后启动/记录主要分段。</p> <div class="language-text highlight"><pre><span></span><code>类型 : uint

默认值 : 16

最小值 : 4
</code></pre></div> <p>该参数控制 MDS 修剪过期日志段的频率（值越高，MDS 更新日志过期位置以进行修剪的频率越低）。</p> <p>最大Segment数由以下参数控制：</p> <p><div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>mds_log_max_segments
</span></code></pre></div> 开始修剪之前，日志中的最大段 （对象） 数。设置为 -1 可禁用限制。</p> <div class="language-text highlight"><pre><span></span><code>类型 : uint

默认值 : 128

最小值 : 8
</code></pre></div> <p>The MDS will often sit a little above this number due to non-major segments awaiting trimming up to the next major segment.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../posix/ class="md-footer__link md-footer__link--prev" aria-label="上一页: POSIX兼容性"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> POSIX兼容性 </div> </div> </a> <a href=../file-layouts/ class="md-footer__link md-footer__link--next" aria-label="下一页: 文件布局(Layout)"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> 文件布局(Layout) </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../../../assets/javascripts/bundle.92b07e13.min.js></script> <script src=../../../../javascripts/katex.js></script> <script src=https://unpkg.com/katex@0/dist/katex.min.js></script> <script src=https://unpkg.com/katex@0/dist/contrib/auto-render.min.js></script> <script src=../../../../assets/javascripts/custom.9e5da760.min.js></script> </body> </html>