<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://yzmjy.github.io/ceph_doc/ceph_file_system/cephfs_concepts/multimds/ rel=canonical><link href=../dirfrags/ rel=prev><link href=../snapshots/ rel=next><link rel=icon href=../../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.18"><title>多活MDS - XZMJX</title><link rel=stylesheet href=../../../../assets/stylesheets/main.7e37652d.min.css><link rel=stylesheet href=../../../../assets/stylesheets/palette.06af60db.min.css><style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%209.5A2.5%202.5%200%200%200%209.5%2012a2.5%202.5%200%200%200%202.5%202.5%202.5%202.5%200%200%200%202.5-2.5A2.5%202.5%200%200%200%2012%209.5m0%203.5a1%201%200%200%201-1-1%201%201%200%200%201%201-1%201%201%200%200%201%201%201%201%201%200%200%201-1%201m0-3.5A2.5%202.5%200%200%200%209.5%2012a2.5%202.5%200%200%200%202.5%202.5%202.5%202.5%200%200%200%202.5-2.5A2.5%202.5%200%200%200%2012%209.5m0%203.5a1%201%200%200%201-1-1%201%201%200%200%201%201-1%201%201%200%200%201%201%201%201%201%200%200%201-1%201m0-11A10%2010%200%200%200%202%2012a10%2010%200%200%200%2010%2010%2010%2010%200%200%200%2010-10A10%2010%200%200%200%2012%202m0%2014c-2.63%200-5-1.57-6-4a6.505%206.505%200%200%201%208.5-3.5A6.52%206.52%200%200%201%2018%2012c-1%202.43-3.37%204-6%204m0-6.5A2.5%202.5%200%200%200%209.5%2012a2.5%202.5%200%200%200%202.5%202.5%202.5%202.5%200%200%200%202.5-2.5A2.5%202.5%200%200%200%2012%209.5m0%203.5a1%201%200%200%201-1-1%201%201%200%200%201%201-1%201%201%200%200%201%201%201%201%201%200%200%201-1%201%22/%3E%3C/svg%3E');}</style><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=https://unpkg.com/katex@0/dist/katex.min.css><script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><link rel=stylesheet href=../../../../assets/stylesheets/custom.7c86dd97.min.css></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=teal> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#active-mds class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=页眉> <a href=../../../.. title=XZMJX class="md-header__button md-logo" aria-label=XZMJX data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> XZMJX </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> 多活MDS </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=teal aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=teal aria-label="Switch to system preference" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=查找> <a href=javascript:void(0) class="md-search__icon md-icon" title=分享 aria-label=分享 data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=清空当前内容 aria-label=清空当前内容 tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> 正在初始化搜索引擎 </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=标签 data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../blog/ class=md-tabs__link> 笔记 </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../../lc/algo/ class=md-tabs__link> 杂 </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=导航栏 data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../.. title=XZMJX class="md-nav__button md-logo" aria-label=XZMJX data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> XZMJX </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1> <div class="md-nav__link md-nav__container"> <a href=../../../../blog/ class="md-nav__link "> <span class=md-ellipsis> 笔记 </span> </a> <label class="md-nav__link " for=__nav_1 id=__nav_1_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_1_label aria-expanded=false> <label class=md-nav__title for=__nav_1> <span class="md-nav__icon md-icon"></span> 笔记 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_2> <label class=md-nav__link for=__nav_1_2 id=__nav_1_2_label tabindex=0> <span class=md-ellipsis> 归档 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_1_2> <span class="md-nav__icon md-icon"></span> 归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../blog/archive/2025/ class=md-nav__link> <span class=md-ellipsis> 2025 </span> </a> </li> <li class=md-nav__item> <a href=../../../../blog/archive/2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_1_3> <label class=md-nav__link for=__nav_1_3 id=__nav_1_3_label tabindex=0> <span class=md-ellipsis> 分类 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_1_3_label aria-expanded=false> <label class=md-nav__title for=__nav_1_3> <span class="md-nav__icon md-icon"></span> 分类 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../blog/category/c/ class=md-nav__link> <span class=md-ellipsis> C++ </span> </a> </li> <li class=md-nav__item> <a href=../../../../blog/category/go/ class=md-nav__link> <span class=md-ellipsis> Go </span> </a> </li> <li class=md-nav__item> <a href=../../../../blog/category/kubernetes/ class=md-nav__link> <span class=md-ellipsis> Kubernetes </span> </a> </li> <li class=md-nav__item> <a href=../../../../blog/category/linux/ class=md-nav__link> <span class=md-ellipsis> Linux </span> </a> </li> <li class=md-nav__item> <a href=../../../../blog/category/minio/ class=md-nav__link> <span class=md-ellipsis> MinIO </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex> <span class=md-ellipsis> 杂 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> 杂 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1> <div class="md-nav__link md-nav__container"> <a href=../../../../lc/algo/ class="md-nav__link "> <span class=md-ellipsis> 数据结构与算法 </span> </a> <label class="md-nav__link " for=__nav_2_1 id=__nav_2_1_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1> <span class="md-nav__icon md-icon"></span> 数据结构与算法 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_1_2> <label class=md-nav__link for=__nav_2_1_2 id=__nav_2_1_2_label tabindex=0> <span class=md-ellipsis> 基础知识 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_1_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_1_2> <span class="md-nav__icon md-icon"></span> 基础知识 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/algo/array/ class=md-nav__link> <span class=md-ellipsis> Array </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/algo/string/ class=md-nav__link> <span class=md-ellipsis> String </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/algo/heap/ class=md-nav__link> <span class=md-ellipsis> Heap </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <div class="md-nav__link md-nav__container"> <a href=../../../../lc/top-interview-150/ class="md-nav__link "> <span class=md-ellipsis> 刷题 </span> </a> <label class="md-nav__link " for=__nav_2_2 id=__nav_2_2_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> 刷题 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2> <label class=md-nav__link for=__nav_2_2_2 id=__nav_2_2_2_label tabindex=0> <span class=md-ellipsis> Top150 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2> <span class="md-nav__icon md-icon"></span> Top150 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_1> <label class=md-nav__link for=__nav_2_2_2_1 id=__nav_2_2_2_1_label tabindex=0> <span class=md-ellipsis> 数组/字符串 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_1_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_1> <span class="md-nav__icon md-icon"></span> 数组/字符串 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/1_88_%E5%90%88%E5%B9%B6%E4%B8%A4%E4%B8%AA%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 88. 合并两个有序数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/2_27_%E7%A7%BB%E9%99%A4%E5%85%83%E7%B4%A0/ class=md-nav__link> <span class=md-ellipsis> 27. 移除元素 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/3_26_%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9/ class=md-nav__link> <span class=md-ellipsis> 26. 删除有序数组中的重复项 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/4_80_%E5%88%A0%E9%99%A4%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84%E4%B8%AD%E7%9A%84%E9%87%8D%E5%A4%8D%E9%A1%B9%20II/ class=md-nav__link> <span class=md-ellipsis> 80. 删除有序数组中的重复项 II </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/5_169_%E5%A4%9A%E6%95%B0%E5%85%83%E7%B4%A0/ class=md-nav__link> <span class=md-ellipsis> 169.多数元素 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/6_189_%E8%BD%AE%E8%BD%AC%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 189.轮转数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/7_121_%E4%B9%B0%E5%8D%96%E8%82%A1%E7%A5%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E6%97%B6%E6%9C%BA/ class=md-nav__link> <span class=md-ellipsis> 121.买卖股票的最佳时机 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/8_122_%E4%B9%B0%E5%8D%96%E8%82%A1%E7%A5%A8%E7%9A%84%E6%9C%80%E4%BD%B3%E6%97%B6%E6%9C%BA%20II/ class=md-nav__link> <span class=md-ellipsis> 122. 买卖股票的最佳时机 II </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/9_55_%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F/ class=md-nav__link> <span class=md-ellipsis> 55. 跳跃游戏 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/10_45_%E8%B7%B3%E8%B7%83%E6%B8%B8%E6%88%8F%20II/ class=md-nav__link> <span class=md-ellipsis> 45. 跳跃游戏 II </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/11_274_H%20%E6%8C%87%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 274. H 指数 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/12_380_O%281%29%E6%97%B6%E9%97%B4%E6%8F%92%E5%85%A5%E3%80%81%E5%88%A0%E9%99%A4%E5%92%8C%E8%8E%B7%E5%8F%96%E9%9A%8F%E6%9C%BA%E5%85%83%E7%B4%A0/ class=md-nav__link> <span class=md-ellipsis> 380. O(1) 时间插入、删除和获取随机元素 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/13_238_%E9%99%A4%E8%87%AA%E8%BA%AB%E4%BB%A5%E5%A4%96%E6%95%B0%E7%BB%84%E7%9A%84%E4%B9%98%E7%A7%AF/ class=md-nav__link> <span class=md-ellipsis> 238. 除自身以外数组的乘积 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/14_134_%E5%8A%A0%E6%B2%B9%E7%AB%99/ class=md-nav__link> <span class=md-ellipsis> 134. 加油站 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/15_135_%E5%88%86%E5%8F%91%E7%B3%96%E6%9E%9C/ class=md-nav__link> <span class=md-ellipsis> 135. 分发糖果 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/16_42_%E6%8E%A5%E9%9B%A8%E6%B0%B4/ class=md-nav__link> <span class=md-ellipsis> 42. 接雨水 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/17_13_%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97%E8%BD%AC%E6%95%B4%E6%95%B0/ class=md-nav__link> <span class=md-ellipsis> 13.罗马数字转整数 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/18_12_%E6%95%B4%E6%95%B0%E8%BD%AC%E7%BD%97%E9%A9%AC%E6%95%B0%E5%AD%97/ class=md-nav__link> <span class=md-ellipsis> 12. 整数转罗马数字 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/19_58_%E6%9C%80%E5%90%8E%E4%B8%80%E4%B8%AA%E5%8D%95%E8%AF%8D%E7%9A%84%E9%95%BF%E5%BA%A6/ class=md-nav__link> <span class=md-ellipsis> 58. 最后一个单词的长度 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/20_14_%E6%9C%80%E9%95%BF%E5%85%AC%E5%85%B1%E5%89%8D%E7%BC%80/ class=md-nav__link> <span class=md-ellipsis> 14. 最长公共前缀 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/21_%20151_%E5%8F%8D%E8%BD%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E5%8D%95%E8%AF%8D/ class=md-nav__link> <span class=md-ellipsis> 151. 反转字符串中的单词 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/22_6_Z%E5%AD%97%E5%BD%A2%E5%8F%98%E6%8D%A2/ class=md-nav__link> <span class=md-ellipsis> 6.Z 字形变换 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/23_28_%E6%89%BE%E5%87%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%AC%AC%E4%B8%80%E4%B8%AA%E5%8C%B9%E9%85%8D%E9%A1%B9%E7%9A%84%E4%B8%8B%E6%A0%87/ class=md-nav__link> <span class=md-ellipsis> 28. 找出字符串中第一个匹配项的下标 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/24_68_%E6%96%87%E6%9C%AC%E5%B7%A6%E5%8F%B3%E5%AF%B9%E9%BD%90/ class=md-nav__link> <span class=md-ellipsis> 68. 文本左右对齐 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_2> <label class=md-nav__link for=__nav_2_2_2_2 id=__nav_2_2_2_2_label tabindex=0> <span class=md-ellipsis> 双指针 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_2> <span class="md-nav__icon md-icon"></span> 双指针 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/25_125_%E9%AA%8C%E8%AF%81%E5%9B%9E%E6%96%87%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 125. 验证回文串 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/26_392_%E5%88%A4%E6%96%AD%E5%AD%90%E5%BA%8F%E5%88%97/ class=md-nav__link> <span class=md-ellipsis> 392. 判断子序列 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/27_167_%E4%B8%A4%E6%95%B0%E4%B9%8B%E5%92%8CII-%E8%BE%93%E5%85%A5%E6%9C%89%E5%BA%8F%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 27. 两数之和 II - 输入有序数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/28_11_%E7%9B%9B%E6%9C%80%E5%A4%9A%E6%B0%B4%E7%9A%84%E5%AE%B9%E5%99%A8/ class=md-nav__link> <span class=md-ellipsis> 11. 盛最多水的容器 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/29_15_%E4%B8%89%E6%95%B0%E4%B9%8B%E5%92%8C/ class=md-nav__link> <span class=md-ellipsis> 15. 三数之和 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_3> <label class=md-nav__link for=__nav_2_2_2_3 id=__nav_2_2_2_3_label tabindex=0> <span class=md-ellipsis> 滑动窗口 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_3> <span class="md-nav__icon md-icon"></span> 滑动窗口 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/30_209_%E9%95%BF%E5%BA%A6%E6%9C%80%E5%B0%8F%E7%9A%84%E5%AD%90%E6%95%B0%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 209. 长度最小的子数组 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/31_3_%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%97%E7%AC%A6%E7%9A%84%E6%9C%80%E9%95%BF%E5%AD%90%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 3. 无重复字符的最长子串 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/32_30_%E4%B8%B2%E8%81%94%E6%89%80%E6%9C%89%E5%8D%95%E8%AF%8D%E7%9A%84%E5%AD%90%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 32. 串联所有单词的子串 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/33_76_%E6%9C%80%E5%B0%8F%E8%A6%86%E7%9B%96%E5%AD%90%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 76. 最小覆盖子串 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_4> <label class=md-nav__link for=__nav_2_2_2_4 id=__nav_2_2_2_4_label tabindex=0> <span class=md-ellipsis> 矩阵 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_4_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_4> <span class="md-nav__icon md-icon"></span> 矩阵 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/34_36_%E6%9C%89%E6%95%88%E7%9A%84%E6%95%B0%E7%8B%AC/ class=md-nav__link> <span class=md-ellipsis> 36. 有效的数独 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/35_54_%E8%9E%BA%E6%97%8B%E7%9F%A9%E9%98%B5/ class=md-nav__link> <span class=md-ellipsis> 54. 螺旋矩阵 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/36_48_%E6%97%8B%E8%BD%AC%E5%9B%BE%E5%83%8F/ class=md-nav__link> <span class=md-ellipsis> 48. 旋转图像 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/37_73_%E7%9F%A9%E9%98%B5%E7%BD%AE%E9%9B%B6/ class=md-nav__link> <span class=md-ellipsis> 73. 矩阵置零 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2_2_5> <label class=md-nav__link for=__nav_2_2_2_5 id=__nav_2_2_2_5_label tabindex=0> <span class=md-ellipsis> 哈希表 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_2_2_5_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2_2_5> <span class="md-nav__icon md-icon"></span> 哈希表 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/39_383_%E8%B5%8E%E9%87%91%E4%BF%A1/ class=md-nav__link> <span class=md-ellipsis> 383. 赎金信 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/40_205_%E5%90%8C%E6%9E%84%E5%AD%97%E7%AC%A6%E4%B8%B2/ class=md-nav__link> <span class=md-ellipsis> 205. 同构字符串 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/41_290_%E5%8D%95%E8%AF%8D%E8%A7%84%E5%BE%8B/ class=md-nav__link> <span class=md-ellipsis> 290. 单词规律 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/42_242_%E6%9C%89%E6%95%88%E7%9A%84%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D/ class=md-nav__link> <span class=md-ellipsis> 242. 有效的字母异位词 </span> </a> </li> <li class=md-nav__item> <a href=../../../../lc/top-interview-150/43_49_%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D%E5%88%86%E7%BB%84/ class=md-nav__link> <span class=md-ellipsis> 49. 字母异位词分组 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3 checked> <div class="md-nav__link md-nav__container"> <a href=../../../ class="md-nav__link "> <span class=md-ellipsis> CEPH文档翻译 </span> </a> <label class="md-nav__link " for=__nav_2_3 id=__nav_2_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> CEPH文档翻译 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_2 checked> <div class="md-nav__link md-nav__container"> <a href=../../ class="md-nav__link "> <span class=md-ellipsis> CEPH文件系统 </span> </a> <label class="md-nav__link " for=__nav_2_3_2 id=__nav_2_3_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=3 aria-labelledby=__nav_2_3_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_2> <span class="md-nav__icon md-icon"></span> CEPH文件系统 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_2_2 checked> <label class=md-nav__link for=__nav_2_3_2_2 id=__nav_2_3_2_2_label tabindex=0> <span class=md-ellipsis> CephFS 概念 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_2_2_label aria-expanded=true> <label class=md-nav__title for=__nav_2_3_2_2> <span class="md-nav__icon md-icon"></span> CephFS 概念 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../mds-states/ class=md-nav__link> <span class=md-ellipsis> MDS状态 </span> </a> </li> <li class=md-nav__item> <a href=../posix/ class=md-nav__link> <span class=md-ellipsis> POSIX兼容性 </span> </a> </li> <li class=md-nav__item> <a href=../mds-journaling/ class=md-nav__link> <span class=md-ellipsis> MDS Journal </span> </a> </li> <li class=md-nav__item> <a href=../file-layouts/ class=md-nav__link> <span class=md-ellipsis> 文件布局(Layout) </span> </a> </li> <li class=md-nav__item> <a href=../mdcache/ class=md-nav__link> <span class=md-ellipsis> 分布式元数据缓存 </span> </a> </li> <li class=md-nav__item> <a href=../dynamic-metadata-mangement/ class=md-nav__link> <span class=md-ellipsis> CEPHFS动态元数据管理 </span> </a> </li> <li class=md-nav__item> <a href=../cephfs-io-path/ class=md-nav__link> <span class=md-ellipsis> CEPHFS IO路径 </span> </a> </li> <li class=md-nav__item> <a href=../charmap/ class=md-nav__link> <span class=md-ellipsis> 大小写敏感性和规范化 </span> </a> </li> <li class=md-nav__item> <a href=../lazyio/ class=md-nav__link> <span class=md-ellipsis> 惰性IO </span> </a> </li> <li class=md-nav__item> <a href=../dirfrags/ class=md-nav__link> <span class=md-ellipsis> 目录分片 </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> 多活MDS </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> 多活MDS </span> </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#mds class=md-nav__link> <span class=md-ellipsis> 何时应该使用多个MDS </span> </a> </li> <li class=md-nav__item> <a href=#mds-active class=md-nav__link> <span class=md-ellipsis> 增加 MDS Active集群的大小 </span> </a> </li> <li class=md-nav__item> <a href=#standby class=md-nav__link> <span class=md-ellipsis> StandBy 进程 </span> </a> </li> <li class=md-nav__item> <a href=#rank class=md-nav__link> <span class=md-ellipsis> 减少Rank的数量 </span> </a> </li> <li class=md-nav__item> <a href=#rank_1 class=md-nav__link> <span class=md-ellipsis> 手动将目录树固定到特定Rank </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../snapshots/ class=md-nav__link> <span class=md-ellipsis> 快照 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3_2_3> <label class=md-nav__link for=__nav_2_3_2_3 id=__nav_2_3_2_3_label tabindex=0> <span class=md-ellipsis> 开发者指南 </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=4 aria-labelledby=__nav_2_3_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3_2_3> <span class="md-nav__icon md-icon"></span> 开发者指南 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../developer-guides/capabilities/ class=md-nav__link> <span class=md-ellipsis> 客户端权限 </span> </a> </li> <li class=md-nav__item> <a href=../../developer-guides/journaler/ class=md-nav__link> <span class=md-ellipsis> Journaler配置 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../architecture/architecture/ class=md-nav__link> <span class=md-ellipsis> CEPH架构 </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> 目录 </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#mds class=md-nav__link> <span class=md-ellipsis> 何时应该使用多个MDS </span> </a> </li> <li class=md-nav__item> <a href=#mds-active class=md-nav__link> <span class=md-ellipsis> 增加 MDS Active集群的大小 </span> </a> </li> <li class=md-nav__item> <a href=#standby class=md-nav__link> <span class=md-ellipsis> StandBy 进程 </span> </a> </li> <li class=md-nav__item> <a href=#rank class=md-nav__link> <span class=md-ellipsis> 减少Rank的数量 </span> </a> </li> <li class=md-nav__item> <a href=#rank_1 class=md-nav__link> <span class=md-ellipsis> 手动将目录树固定到特定Rank </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=active-mds>配置多个Active MDS进程<a class=headerlink href=#active-mds title="Permanent link">&para;</a></h1> <p><em>也被称为：多活MDS、active-active MDS</em></p> <p>默认情况下，每个CephFS都配置了一个MDS守护进程。但是，在大规模系统中，您可以配置多个MDS守护进程，以提高系统的元数据性能，这些MDS进程将共同处理元数据工作负载。</p> <h2 id=mds>何时应该使用多个MDS<a class=headerlink href=#mds title="Permanent link">&para;</a></h2> <p>总的来说，当您的文件系统元数据性能在单个MDS上遇到了瓶颈，此时您应该考虑使用多个MDS。</p> <p>添加更多的MDS并不是在所有工作负载下都能提高系统性能，通常，在单个客户端上运行的单个应用程序的工作负载下，使用多个MDS并不会带来明显的性能提升，除非该应用程序正在并行执行大量元数据操作。</p> <p>通过使用多活MDS带来性能提升的场景通常是那些具有许多客户端的工作负载，这些客户端可能在许多独立的目录中工作。</p> <h2 id=mds-active>增加 MDS Active集群的大小<a class=headerlink href=#mds-active title="Permanent link">&para;</a></h2> <p>每个 CephFS 文件系统都有一个 <code>max_mds</code> 的参数，用于控制将创建的 Rank 数。只有当备用 MDS 守护进程可用于承担新的 Rank 时，文件系统中的实际 Rank 数才会增加。例如，如果只有一个 MDS 守护程序正在运行，并且 <code>max_mds</code> 设置为 2，那么，文件系统不会创建第二个 Rank。（请注意，像这样进行配置是不具备高可用性(HA)的，因为没有备用 MDS 可用于接管失败的Rank。以这种方式配置时，集群会产生健康状态的警告。</p> <p>将 <code>max_mds</code> 设置为所需的 Rank 数。在以下示例中，通过 “ceph status” 的 “fsmap” 行，来说明命令的预期结果。</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a># fsmap e5: 1/1/1 up {0=a=up:active}, 2 up:standby
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>ceph fs set &lt;fs_name&gt; max_mds 2
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a># fsmap e8: 2/2/2 up {0=a=up:active,1=c=up:creating}, 1 up:standby
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a># fsmap e9: 2/2/2 up {0=a=up:active,1=c=up:active}, 1 up:standby
</span></code></pre></div> <p>新创建的Rank(1) 将通过 'creating' 状态，进入 'active' 状态。</p> <h2 id=standby>StandBy 进程<a class=headerlink href=#standby title="Permanent link">&para;</a></h2> <p>即使有多个Active的 MDS 进程，为了实现系统的高可用性，仍需要配置备用的MDS进程来接管发生故障的活跃MDS进程。</p> <p>因此，高可用性系统的实际最大 <code>max_mds</code> 最多比系统中 MDS 服务器的总数少 1。</p> <p>要在发生多个服务器故障时保持可用，请增加系统中备用 MDS 的数量，以匹配您希望承受的服务器故障数量。</p> <h2 id=rank>减少Rank的数量<a class=headerlink href=#rank title="Permanent link">&para;</a></h2> <p>减少等级数就像减少 <code>max_mds</code> 一样简单：</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a># fsmap e9: 2/2/2 up {0=a=up:active,1=c=up:active}, 1 up:standby
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>ceph fs set &lt;fs_name&gt; max_mds 1
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a># fsmap e10: 2/2/1 up {0=a=up:active,1=c=up:stopping}, 1 up:standby
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a># fsmap e10: 2/2/1 up {0=a=up:active,1=c=up:stopping}, 1 up:standby
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>...
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a># fsmap e10: 1/1/1 up {0=a=up:active}, 2 up:standby
</span></code></pre></div> <p>集群将自动逐步停止额外的Rank，直到Rank数等于 <code>max_mds</code>。</p> <p>See CephFS Administrative commands for more details which forms <role> can take.</p> <p>注意：已停止的等级将首先进入stopping状态一段时间，同时将其管理的元数据移交给剩余的Active MDS。此阶段可能需要几秒钟到几分钟。如果 MDS 卡在stopping状态，则应将其作为可能的 bug 进行调查。</p> <p>If an MDS daemon crashes or is killed while in the up:stopping state, a standby will take over and the cluster monitors will against try to stop the daemon. 如果 MDS 守护程序在 <code>up：stopping</code> 状态下崩溃或被终止，则备用MDS将接管它，MON 集群将反对尝试停止守护程序。</p> <p>当 MDS 结束了stopping状态后，它将恢复为备用MDS。</p> <h2 id=rank_1>手动将目录树固定到特定Rank<a class=headerlink href=#rank_1 title="Permanent link">&para;</a></h2> <p>In multiple active metadata server configurations, a balancer runs which works to spread metadata load evenly across the cluster. This usually works well enough for most users but sometimes it is desirable to override the dynamic balancer with explicit mappings of metadata to particular ranks. This can allow the administrator or users to evenly spread application load or limit impact of users’ metadata requests on the entire cluster. 在多个活动元数据服务器配置中，将运行一个平衡器，该平衡器用于将元数据负载均匀地分布在集群中。对于大多数用户来说，这通常已经足够好了，但有时需要用元数据到特定等级的显式 Map 来覆盖 dynamic balancer。这可以允许管理员或用户均匀分配应用程序负载或限制用户的元数据请求对整个集群的影响。</p> <p>The mechanism provided for this purpose is called an export pin, an extended attribute of directories. The name of this extended attribute is ceph.dir.pin. Users can set this attribute using standard commands: 为此目的提供的机制称为导出引脚 ，即 目录的 extended 属性。此扩展属性的名称为 用户可以使用标准命令设置此属性：</p> <p>setfattr -n ceph.dir.pin -v 2 path/to/dir The value of the extended attribute is the rank to assign the directory subtree to. A default value of -1 indicates the directory is not pinned. extended 属性的值是要将目录子树分配到的排名。默认值 -1 表示目录未固定。</p> <p>A directory’s export pin is inherited from its closest parent with a set export pin. In this way, setting the export pin on a directory affects all of its children. However, the parents pin can be overridden by setting the child directory’s export pin. For example: 目录的导出引脚继承自其最近的父级，并设置了导出引脚。这样，在目录上设置 export pin 会影响其所有子项。但是，可以通过设置子目录的 export pin 来覆盖 parents pin。例如：</p> <p>mkdir -p a/b</p> <h1 id=a-and-ab-both-start-without-an-export-pin-set>"a" and "a/b" both start without an export pin set<a class=headerlink href=#a-and-ab-both-start-without-an-export-pin-set title="Permanent link">&para;</a></h1> <p>setfattr -n ceph.dir.pin -v 1 a/</p> <h1 id=a-and-b-are-now-pinned-to-rank-1>a and b are now pinned to rank 1<a class=headerlink href=#a-and-b-are-now-pinned-to-rank-1 title="Permanent link">&para;</a></h1> <p>setfattr -n ceph.dir.pin -v 0 a/b</p> <h1 id=ab-is-now-pinned-to-rank-0-and-a-and-the-rest-of-its-children-are-still-pinned-to-rank-1>a/b is now pinned to rank 0 and a/ and the rest of its children are still pinned to rank 1<a class=headerlink href=#ab-is-now-pinned-to-rank-0-and-a-and-the-rest-of-its-children-are-still-pinned-to-rank-1 title="Permanent link">&para;</a></h1> <p>Setting subtree partitioning policies 设置子树分区策略  It is also possible to setup automatic static partitioning of subtrees via a set of policies. In CephFS, this automatic static partitioning is referred to as ephemeral pinning. Any directory (inode) which is ephemerally pinned will be automatically assigned to a particular rank according to a consistent hash of its inode number. The set of all ephemerally pinned directories should be uniformly distributed across all ranks. 还可以通过一组策略设置子树的自动静态分区。在 CephFS 中，这种自动静态分区称为临时固定 。任何临时固定的目录 （inode） 都将根据其 inode 编号的一致哈希值自动分配给特定排名。所有临时固定目录的集合应均匀分布在所有等级中。</p> <p>Ephemerally pinned directories are so named because the pin may not persist once the directory inode is dropped from cache. However, an MDS failover does not affect the ephemeral nature of the pinned directory. The MDS records what subtrees are ephemerally pinned in its journal so MDS failovers do not drop this information. 临时固定目录之所以如此命名，是因为一旦从缓存中删除目录 inode，该 pin 可能不会保留。但是，MDS 故障转移不会影响固定目录的短暂性。MDS 会记录哪些子树在其日志中短暂固定，因此 MDS 故障转移不会丢弃此信息。</p> <p>A directory is either ephemerally pinned or not. Which rank it is pinned to is derived from its inode number and a consistent hash. This means that ephemerally pinned directories are somewhat evenly spread across the MDS cluster. The consistent hash also minimizes redistribution when the MDS cluster grows or shrinks. So, growing an MDS cluster may automatically increase your metadata throughput with no other administrative intervention. 目录要么是临时固定的，要么不是。它固定到哪个排名是从它的 inode 编号和一致的哈希值派生的。这意味着临时固定目录在 MDS 群集中分布得比较均匀。当 MDS 群集增长或收缩时， 一致性哈希还可以最大限度地减少重新分配。因此，扩大 MDS 集群可能会自动增加元数据吞吐量，而无需其他管理干预。</p> <p>Presently, there are two types of ephemeral pinning: 目前，有两种类型的短暂固定：</p> <p>Distributed Ephemeral Pins: This policy causes a directory to fragment (even well below the normal fragmentation thresholds) and distribute its fragments as ephemerally pinned subtrees. This has the effect of distributing immediate children across a range of MDS ranks. The canonical example use-case would be the /home directory: we want every user’s home directory to be spread across the entire MDS cluster. This can be set via: 分布式临时 Pin： 此策略会导致目录碎片化（甚至远低于正常的碎片阈值）并将其碎片作为临时固定的子树进行分发。这具有在一系列 MDS 等级之间分配直系子级的效果。规范的示例用例是 /home 目录：我们希望每个用户的主目录分布在整个 MDS 集群中。这可以通过以下方式进行设置：</p> <p>setfattr -n ceph.dir.pin.distributed -v 1 /cephfs/home Random Ephemeral Pins: This policy indicates any descendent sub-directory may be ephemerally pinned. This is set through the extended attribute ceph.dir.pin.random with the value set to the percentage of directories that should be pinned. For example: Random Ephemeral Pins：此策略指示任何派生子目录 可能被短暂固定。这是通过 extended 属性 ceph.dir.pin.random 的目录，该值设置为应固定的目录的百分比。例如：</p> <p>setfattr -n ceph.dir.pin.random -v 0.5 /cephfs/tmp Would cause any directory loaded into cache or created under /tmp to be ephemerally pinned 50 percent of the time. 将导致加载到缓存中或在 /tmp 下创建的任何目录在 50% 的时间内短暂固定。</p> <p>It is recommended to only set this to small values, like .001 or 0.1%. Having too many subtrees may degrade performance. For this reason, the config mds_export_ephemeral_random_max enforces a cap on the maximum of this percentage (default: .01). The MDS returns EINVAL when attempting to set a value beyond this config. 建议仅将其设置为较小的值，例如 .001 或 0.1%。 子树过多可能会降低性能。因此，配置 mds_export_ephemeral_random_max 强制设置此百分比的最大值上限（默认值：.01）。MDS 在尝试设置超出此配置的值时返回 EINVAL。</p> <p>Both random and distributed ephemeral pin policies are off by default in Octopus. The features may be enabled via the mds_export_ephemeral_random and mds_export_ephemeral_distributed configuration options. 默认情况下，随机和分布式临时 pin 策略在 章鱼。这些功能可以通过 mds_export_ephemeral_random 和 mds_export_ephemeral_distributed 配置选项。</p> <p>Ephemeral pins may override parent export pins and vice versa. What determines which policy is followed is the rule of the closest parent: if a closer parent directory has a conflicting policy, use that one instead. For example: 临时 pin 可能会覆盖父 export pin，反之亦然。决定遵循哪个策略的是最近的父目录的规则：如果较近的父目录具有冲突的策略，请改用该策略。例如：</p> <p>mkdir -p foo/bar1/baz foo/bar2 setfattr -n ceph.dir.pin -v 0 foo setfattr -n ceph.dir.pin.distributed -v 1 foo/bar1 The foo/bar1/baz directory will be ephemerally pinned because the foo/bar1 policy overrides the export pin on foo. The foo/bar2 directory will obey the pin on foo normally. foo/bar1/baz 目录将被临时固定，因为 foo/bar1 策略覆盖 foo 上的 export pin。foo/bar2 目录将正常服从 foo 上的 pin。</p> <p>For the reverse situation: 对于相反的情况：</p> <p>mkdir -p home/{patrick,john} setfattr -n ceph.dir.pin.distributed -v 1 home setfattr -n ceph.dir.pin -v 2 home/patrick The home/patrick directory and its children will be pinned to rank 2 because its export pin overrides the policy on home. home/patrick 目录及其子目录将被固定到排名 2，因为它的 export pin 覆盖了 home 上的策略。</p> <p>To remove a partitioning policy, remove the respective extended attribute or set the value to 0. 要删除分区策略，请删除相应的扩展属性或将值设置为 0。</p> <p>$ setfattr -n ceph.dir.pin.distributed -v 0 home</p> <h1 id=or>or<a class=headerlink href=#or title="Permanent link">&para;</a></h1> <p>$ setfattr -x ceph.dir.pin.distributed home For export pins, remove the extended attribute or set the extended attribute value to -1. 对于导出引脚，请删除 extended 属性或将 extended 属性值设置为 -1。</p> <p>$ setfattr -n ceph.dir.pin -v -1 home Dynamic Subtree Partitioning 动态子树分区  CephFS has long had a dynamic metadata balancer (sometimes called the “default balancer”) which can split or merge subtrees while placing them on “colder” MDS ranks. Moving the metadata in this way improves overall file system throughput and cache size. CephFS 长期以来一直有一个动态元数据平衡器（有时称为“默认平衡器”），它可以拆分或合并子树，同时将它们放置在“较冷”的 MDS 等级中。以这种方式移动元数据可以提高整体文件系统吞吐量和缓存大小。</p> <p>However, the balancer is sometimes inefficient or slow, so by default it is turned off. This is to avoid an administrator “turning on multimds” by increasing the max_mds setting only to find that the balancer has made a mess of the cluster performance (reverting from this messy state of affairs is straightforward but can take time). 但是，平衡器有时效率低下或速度较慢，因此默认情况下它是关闭的。这是为了避免管理员通过增加 max_mds 设置来“打开 multimds”，却发现 balancer 器已经把集群性能搞得一团糟（从这种混乱的状态中恢复过来很简单，但可能需要时间）。</p> <p>To turn on the balancer, run a command of the following form: 要打开平衡器，请运行以下形式的命令：</p> <p>ceph fs set <fs_name> balance_automate true Turn on the balancer only with an appropriate configuration, such as a configuration that includes the bal_rank_mask setting (described below). 仅使用适当的配置打开平衡器，例如包含 bal_rank_mask 设置（描述 ）。</p> <p>Careful monitoring of the file system performance and MDS is advised. 建议仔细监控文件系统性能和 MDS。</p> <p>Dynamic subtree partitioning with Balancer on specific ranks 在特定等级上使用 Balancer 进行动态子树分区  The CephFS file system provides the bal_rank_mask option to enable the balancer to dynamically rebalance subtrees within particular active MDS ranks. This allows administrators to employ both the dynamic subtree partitioning and static pining schemes in different active MDS ranks so that metadata loads are optimized based on user demand. For instance, in realistic cloud storage environments, where a lot of subvolumes are allotted to multiple computing nodes (e.g., VMs and containers), some subvolumes that require high performance are managed by static partitioning, whereas most subvolumes that experience a moderate workload are managed by the balancer. As the balancer evenly spreads the metadata workload to all active MDS ranks, performance of static pinned subvolumes inevitably may be affected or degraded. If this option is enabled, subtrees managed by the balancer are not affected by static pinned subtrees. CephFS 文件系统提供了 bal_rank_mask 选项，使平衡器能够动态地重新平衡特定活动 MDS 等级中的子树。这允许管理员在不同的活动 MDS 等级中同时使用动态子树分区和静态固定方案，以便根据用户需求优化元数据加载。例如，在实际的云存储环境中，大量子卷被分配给多个计算节点（例如，VM 和容器），一些需要高性能的子卷由静态分区管理，而大多数工作负载适中的子卷由 balancer 管理。由于平衡器将元数据工作负载均匀地分散到所有活动的 MDS 排名，因此静态固定子卷的性能可能不可避免地受到影响或降级。如果启用此选项，则 balancer 管理的子树不会受到静态固定子树的影响。</p> <p>This option can be configured with the ceph fs set command. For example: 可以使用 ceph fs set 命令配置此选项。例如：</p> <p>ceph fs set <fs_name> bal_rank_mask <hex> Each bitfield of the <hex> number represents a dedicated rank. If the <hex> is set to 0x3, the balancer runs on active 0 and 1 ranks. For example: <hex> 数字的每个位域代表一个专用 rank。如果 <hex> 设置为 0x3，则平衡器在活动 0 和 1 等级上运行。例如：</p> <p>ceph fs set <fs_name> bal_rank_mask 0x3 If the bal_rank_mask is set to -1 or all, all active ranks are masked and utilized by the balancer. As an example: 如果 bal_rank_mask 设置为 -1 或 all，则所有活动排名都将被屏蔽并由 balancer 器使用。例如：</p> <p>ceph fs set <fs_name> bal_rank_mask -1 On the other hand, if the balancer needs to be disabled, the bal_rank_mask should be set to 0x0. For example: 另一方面，如果需要禁用 balancer，则应将 bal_rank_mask 设置为 0x0。例如：</p> <p>ceph fs set <fs_name> bal_rank_mask 0x0</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> 回到页面顶部 </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=页脚> <a href=../dirfrags/ class="md-footer__link md-footer__link--prev" aria-label="上一页: 目录分片"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> 上一页 </span> <div class=md-ellipsis> 目录分片 </div> </div> </a> <a href=../snapshots/ class="md-footer__link md-footer__link--next" aria-label="下一页: 快照"> <div class=md-footer__title> <span class=md-footer__direction> 下一页 </span> <div class=md-ellipsis> 快照 </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script> <script src=../../../../assets/javascripts/bundle.92b07e13.min.js></script> <script src=../../../../javascripts/katex.js></script> <script src=https://unpkg.com/katex@0/dist/katex.min.js></script> <script src=https://unpkg.com/katex@0/dist/contrib/auto-render.min.js></script> <script src=../../../../assets/javascripts/custom.9e5da760.min.js></script> </body> </html>